@namespace basicApp.Shared.Identity

@using MudBlazor
@using basicApp.Shared
@using basicApp.Data.Storage

@using basicApp.Modules.Db
@using basicApp.Modules.Logging
@using Serilog.Core

@inject TestDbManager tdbm

<div>

    <h1 class="text-xl m-3">
        Persons in test db:
    </h1>

    @foreach (var person in tdbm.ReadAll())
    {
        <div>
            <p>
                @person.Id | @person.Name | @person.Age | @person.Job
            </p>
            <p>
                Notifications: 
            </p>
            <p>

            </p>
            
            <MudButton>
                Add a notification
            </MudButton>
        </div>
    }
    <div class="m-3">
        <MudTextField @bind-Value="@formName" />
        <MudTextField @bind-Value="@formJob" />
        <MudNumericField @bind-Value="@formAge" />
        <MudButton OnClick="SubmitForm">Add a test person</MudButton>
    </div>

</div>



@code {
    private string formName = "";
    private string formJob = "";
    private short formAge;


    protected override void OnInitialized()
    {
        Log.Debug("Init. Test db entries:");
        Log.Debug("Testdb collection count: {count}", tdbm.ReadAll().Count);
    }
    private void SubmitForm()
    {
        Log.Debug("Inserting new test person");
        Log.Debug("Success: {status}", tdbm.InsertOne(formName, formJob, formAge));
    }
}